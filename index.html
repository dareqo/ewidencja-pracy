<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Ewidencja czasu pracy</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
  </style>
</head>
<body>
  <h1>Ewidencja czasu pracy</h1>

  <button id="startBtn" onclick="startWork()">▶️ Start</button>
  <button id="stopBtn" onclick="stopWork()">⏹️ Zakończ</button>
  <button onclick="exportCSV()">⬇️ Eksportuj CSV</button>

  <table id="logTable">
    <thead>
      <tr>
        <th>Data</th>
        <th>Start</th>
        <th>Koniec</th>
        <th>Czas pracy (min)</th>
      </tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>

  <script>
    function startWork() {
      const now = new Date().toISOString();
      localStorage.setItem("startTime", now);
      updateButtons();
    }

    function stopWork() {
      const start = localStorage.getItem("startTime");
      if (!start) {
        alert("Nie rozpocząłeś pracy.");
        return;
      }

      const startTime = new Date(start);
      const endTime = new Date();
      const duration = Math.round((endTime - startTime) / 60000); // w minutach

      // Dodaj wpis do tabeli
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${startTime.toLocaleDateString()}</td>
        <td>${startTime.toLocaleTimeString()}</td>
        <td>${endTime.toLocaleTimeString()}</td>
        <td>${duration}</td>
      `;
      document.getElementById("logBody").appendChild(row);

      // Zapisz do localStorage (historia)
      const logs = JSON.parse(localStorage.getItem("logs") || "[]");
      logs.push({
        date: startTime.toLocaleDateString(),
        start: startTime.toLocaleTimeString(),
        end: endTime.toLocaleTimeString(),
        duration: duration
      });
      localStorage.setItem("logs", JSON.stringify(logs));

      // Resetuj stan
      localStorage.removeItem("startTime");
      updateButtons();
    }

    function updateButtons() {
      const started = localStorage.getItem("startTime");
      document.getElementById("startBtn").style.display = started ? "none" : "inline-block";
      document.getElementById("stopBtn").style.display = started ? "inline-block" : "none";
    }

    function loadTable() {
      const logs = JSON.parse(localStorage.getItem("logs") || "[]");
      const tbody = document.getElementById("logBody");
      tbody.innerHTML = "";
      logs.forEach(log => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${log.date}</td>
          <td>${log.start}</td>
          <td>${log.end}</td>
          <td>${log.duration}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function exportCSV() {
      const logs = JSON.parse(localStorage.getItem("logs") || "[]");
      if (logs.length === 0) {
        alert("Brak danych do eksportu.");
        return;
      }

      const csvRows = [
        ["Data", "Start", "Koniec", "Czas pracy (min)"],
        ...logs.map(log => [log.date, log.start, log.end, log.duration])
      ];
      const csvContent = csvRows.map(e => e.join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "ewidencja.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    window.onload = () => {
      updateButtons();
      loadTable();
    };
  </script>
</body>
</html>
